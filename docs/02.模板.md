# 02.模板

在 Flask 中，模板被编写为单独的 HTML 文件，存储在应用程序包内的 ``templates`` 文件夹中。

现在我们新建 ``templates`` 文件夹，现在文档结构应该是这样的：
```
microblog/
    app/
        templates/ # 放置模板文件
        __init__.py
        routes.py
    venv/
    microblog.py
```

上一篇中，我们的 ``index()`` 视图函数只是返回字符串，而作为一个网站，更恰当的方法是返回一个 HTML 文件给浏览器。

Flask 中的模板文件支持使用 Jinja2 模板引擎的语法，可以在视图函数把变量作用到模板文件中，也支持选择、循环、过滤等语法。

下面我们在 ``templates`` 文件夹创建模板文件 ``index.html``：
```
# index.html

<html>
  <head>
    <title>{{ title }} - Microblog</title>
  </head>
  <body>
    <h1>Hello, {{ user.username }}!</h1>
  </body>
</html>
```
这里我们注意 HTML 里的双大括号语法：``{{ ... }}``；这就是Jinja2 模板引擎起作用的地方。

同时，我们在编写 ``routes.py`` 修改视图函数 ``index()``，指定返回的模板文件及传递参数。

```
# routes.py

from flask import render_template, Blueprint

main_routes = Blueprint('main', __name__)

@main_routes.route('/')
@main_routes.route('/index')
def index():
    user = {'username': 'Diego'}
    return render_template('index.html', title='Home', user=user)
```

从 Flask 框架中导入 ``render_template()`` 函数。 该函数需要传入模板文件名和模板参数的变量列表，模板引擎会根据变量名和模板文件占位符的名称把相应的位置替换掉，再返回替换后的 HTML 给浏览器。

那么以上的代码运行后会产生什么结果呢？``<title>{{ title }} - Microblog</title>`` 中的 ``title`` 被视图函数中传递来的参数 ``title='Home'`` 替换掉。

而视图函数传递的参数 ``user`` 是一个 Python  对象，模板文件中也能使用对象的语法，``<h1>Hello, {{ user.username }}!</h1>`` 中的 ``user.username`` 自然为字符串 ``Diego`` 所替换。

它产生的新 HTML 文件是这样的：
```
# index.html

<html>
  <head>
    <title>Home - Microblog</title>
  </head>
  <body>
    <h1>Hello, Diego!</h1>
  </body>
</html>
```

<br>
<hr>
<br>


### 条件语句

Jinja2 模板引擎支持在 ``{%...％}`` 块内使用控制语句。下面在 ``index.html`` 模板下添加了一个条件语句：

```
# index.html

<html>
  <head>
    {% if title %}
      <title>{{ title }} - Microblog</title>
    {% else %}
      <title>Welcome to Microblog!</title>
    {% endif %}
  </head>
  <body>
    <h1>Hello, {{ user.username }}!</h1>
  </body>
</html>
```

条件语句中，模板引擎会先判断 ``title`` 参数是否存在，如果不存在的话，就显示 ``else`` 语句的部分。


<br>
<hr>
<br>


### 循环语句

下面例子中，我们模拟用户在网站上浏览用户动态（Post）的过程，正常网站上 Post 应当是储存在数据库中的，现阶段我们暂未涉及数据库，所以在视图函数 ``index()`` 中暂时模拟一下：

```
# routes.py

from flask import render_template, Blueprint

main_routes = Blueprint('main', __name__)

@main_routes.route('/')
@main_routes.route('/index')
def index():
    user = {'username': 'Diego'}

    posts = [
        {
            'author': {'username': 'John'},
            'body': 'Hello World!'
        },
        {
            'author': {'username': 'Diego'},
            'body': 'Hola Wolrd!'
        }
    ]

    return render_template(
        'index.html', 
        title='Home', 
        user=user, 
        posts=posts
    )
```

相应地，我们修改模板文件 ``index.html``：
```
# index.html

<html>
  <head>
    {% if title %}
      <title>{{ title }} - Microblog</title>
    {% else %}
      <title>Welcome to Microblog!</title>
    {% endif %}
  </head>

  <body>
    <h1>Hello, {{ user.username }}!</h1>
    {% for post in posts %}
      <div>
        <p>{{ post.author.username }} says: <b>{{ post.body }}</b></p>
      </div>
    {% endfor %}
  </body>
</html>
```

上面例子中，我们清楚看到怎么使用循环语法结合 Python 对象的语法来展示一个复杂的模型，得到的网页：

![](https://upload-images.jianshu.io/upload_images/2070024-a2a79bc14ae57b0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


<br>
<hr>
<br>


### 模板继承

同一个网站内的不同页面都会有相同的部分，比如顶部的导航栏，随着网站的扩大，编写的模板文件也会变得庞大，如果在每一份模板文件都重复一遍导航栏的代码显然不是聪明的做法。

那么能不能编写好模板文件公用的部分，再在不同模板文件里重用呢？

模板继承就是解决这一问题的。Jinja2 允许将所有模板中相同的部分编写在一个基础模板中，然后再把基础模板继承过来。

所以现在要定义一个名为 ``base.html`` 的基本模板，其中包含一个简单的导航栏，以及之前实现的标题逻辑，该文件依旧放置在 ``templates`` 文件夹下。

```
# base.html

<html>
  <head>
    {% if title %}
      <title>{{ title }} - Microblog</title>
    {% else %}
      <title>Welcome to Microblog</title>
    {% endif %}
  </head>
  <body>
    <div>Microblog: <a href="/index">Home</a></div>
    <hr>
    {% block content %}
    {% endblock %}
  </body>
</html>
```

在模板中，使用 ``block`` 语句控制派生模板可以插入代码的位置。

通过从基础模板 ``base.html`` 继承，我现在可以简化模板 ``index.html`` 了：
```
# index.html

{% extends "base.html" %}

{% block content %}
  <h1>Hello, {{ user.username }}!</h1>
  {% for post in posts %}
    <div>
      <p>{{ post.author.username }} says: <b>{{ post.body }}</b></p>
    </div>
  {% endfor %}
{% endblock %}
```

``extends`` 语句表示模板继承自哪个继承模板，派生模板的 ``block`` 语句会替换掉继承模板的 ``block`` 部分。

现在我们的网页长这样：

![](https://upload-images.jianshu.io/upload_images/2070024-e3585d48154924a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

<br>
<hr>
<br>

本章节源码：https://github.com/SingleDiego/Flask-Tutorial-Source-Code/tree/SingleDiego-patch-02